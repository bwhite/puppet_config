# Generated by iptables-save v1.4.12 on Sat Aug 18 13:33:09 2012
*security
:INPUT ACCEPT [8862:5421987]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [8535:5437981]
COMMIT
# Completed on Sat Aug 18 13:33:09 2012
# Generated by iptables-save v1.4.12 on Sat Aug 18 13:33:09 2012
*raw
:PREROUTING ACCEPT [12458:5637699]
:OUTPUT ACCEPT [8535:5437981]
COMMIT
# Completed on Sat Aug 18 13:33:09 2012
# Generated by iptables-save v1.4.12 on Sat Aug 18 13:33:09 2012
*nat
:PREROUTING ACCEPT [3451:207012]
:INPUT ACCEPT [2:120]
:OUTPUT ACCEPT [205:13232]
:POSTROUTING ACCEPT [205:13232]
COMMIT
# Completed on Sat Aug 18 13:33:09 2012
# Generated by iptables-save v1.4.12 on Sat Aug 18 13:33:09 2012
*mangle
:PREROUTING ACCEPT [12458:5637699]
:INPUT ACCEPT [12458:5637699]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [8535:5437981]
:POSTROUTING ACCEPT [8535:5437981]
COMMIT
# Completed on Sat Aug 18 13:33:09 2012
# Generated by iptables-save v1.4.12 on Sat Aug 18 13:33:09 2012
*filter
:INPUT DROP [0:0]
:FORWARD DROP [0:0]
:OUTPUT ACCEPT [422:404349]
:whitelist - [0:0]
-A INPUT -s 127.0.0.1/32 -j ACCEPT
-A INPUT -p tcp -m tcp --dport 22 -m state --state NEW -m recent --set --name SSH --rsource
-A INPUT -p tcp -m tcp --dport 22 -m state --state NEW -m recent --update --seconds 300 --hitcount 20 --rttl --name SSH --rsource -j LOG --log-prefix "SSH_brute_force "
-A INPUT -p tcp -m tcp --dport 22 -m state --state NEW -m recent --update --seconds 300 --hitcount 20 --rttl --name SSH --rsource -j DROP
-A INPUT -p tcp -m multiport --dports 22 -j ACCEPT
-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT
-A INPUT -j whitelist
-A FORWARD -j whitelist
-A OUTPUT -j whitelist
<% whitelist.each do |val| -%>
-A whitelist -s <%= val %>/32 -j ACCEPT
<% end -%>
COMMIT
# Completed on Sat Aug 18 13:33:09 2012
